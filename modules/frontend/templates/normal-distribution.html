{#
 vim:filetype=htmljinja
#}
{% extends "layout.html" %}
{%- block content -%}
<script>
    $(window).addEvent('domready', function () {
        var form = $('normal-distribution-form');
        var fields = {};
        var result_div = document.id('result');
        form.getElements('input[type=text]').each(function (item, index) {
            fields[item.name] = item;
        });
        var norm_cdf = function (x) {
            if (x === 'inf' || x > 5) { return 1; }
            if (x === '-inf' || x < -5) { return 0; }
            if (x < 0) { return 1 - norm_cdf(-1*x); }

            var c = 1/Math.sqrt(2*Math.PI);
            var eps = Math.pow(10,-10);
            var prob = 0.5;
            var fac = 1;
            var n = 0;
            var term = c*x;

            while (Math.abs(term) > eps && n < 100) {
                prob = prob + term;
                n = n + 1;
                fac = n*fac;
                term = c*Math.pow(-1,n)*Math.pow(x,2*n+1)/(Math.pow(2,n)*fac*(2*n+1));
            }

            return prob;
        };
        var round_to = function (num, precision) {
            var m = Math.pow(10, precision);
            return Math.round(num*m) / m ;
        };

        form.addEvent('submit', function (e) {
            var field_setup = {
                'mean': {'default': 0},
                'standard-deviation': {'default': 1},
                'lower-bound': {'default': '-inf'},
                'upper-bound': {'default': 'inf'}
            };
            var tmp_val;
            for (key in field_setup) {
                tmp_val = parseFloat(fields[key].value);
                if (isNaN(tmp_val)) {
                    tmp_val = field_setup[key]["default"];
                }
                fields[key].value = tmp_val;
            }

            var mean = fields["mean"].value;
            var std = fields["standard-deviation"].value;
            if (std === 0) {std = 1;}
            var lower =  fields["lower-bound"].value;
            var upper = fields["upper-bound"].value;
            
            var low_z = (lower === '-inf') ? lower : (lower - mean)/std ;
            var up_z = (upper === 'inf') ? upper : (upper - mean)/std ;

            var result = norm_cdf(up_z) - norm_cdf(low_z);

            var lower_string = (lower === '-inf') ? '' : lower + ' < ' ;
            var upper_string = (upper === 'inf') ? '' : ' < ' + upper ;

            var result_string = ('With $$X\\sim N({mean}, {std}^2)$$ you get' + 
                    ' the result $$P({lower_string}X{upper_string})={result}$$').substitute({
                'mean': mean, 'std': std, 'lower_string': lower_string, 
                'upper_string': upper_string, 'result': round_to(result, 4)
            });

            result_div.set('html', result_string);
            MathJax.Hub.Queue(['Typeset', MathJax.Hub, result_div]);
            e.preventDefault();
        });
    })
</script>
<h2>The normal distribution</h2>
<p>Here you can calculate the cumulative distribution function for the normal distribution.</p>
<h3>Calculator</h3>
<div class="calculator">
    <form action="" method="get" id="normal-distribution-form">
        <div class="form-field mean">
            <label for="mean">Mean</label>
            <input type="text" name="mean" value="0" />
        </div>
        <div class="form-field standard-deviation">
            <label for="standard-deviation">Standard deviation</label>
            <input type="text" name="standard-deviation" value="1" />
        </div>
        <div class="form-field lower-bound">
            <label for="lower-bound">Lower bound</label>
            <input type="text" name="lower-bound" value="-inf" />
        </div>
        <div class="form-field upper-bound">
            <label for="upper-bound">Upper bound</label>
            <input type="text" name="upper-bound" value="inf" />
        </div>
        <div class="form-field">
            <label for="submit">&nbsp;</label>
            <input type="submit" name="submit" value="Calculate" />
        </div>
    </form>
    <div id="result">
        Results are shown here...
    </div>

    <h3>How the normal distribution is calculated</h3>
    <p>
    If a stochastic variable \(X\) is normal distributed with mean \(\mu\) and standard deviation \(\sigma\), the stochastic variable 
    $$
        Z=\frac{X-\mu}{\sigma}
    $$ 
    is standard normal distributed. We therefore only need to find a way to calculate probabilities of the standard normal distribution, to be able to calculate an arbitrary normal distribution. The standard normal distribution has the cumulative density function (cdf)
    $$
        F(x) = \frac{1}{\sqrt{2\pi}} \int_{-\infty}^x e^{-t^2/2}\,\text{dt}
    $$
    Unfortunately this integral can't be solved analytically, so we can only approximate it. We will approximate it with a series representation of the ingral, but to make the following calculations easier, we first look at some properties of the cdf of the standard normal distribution. First of all, since the probability density function (pdf) of the standard normal distribution is symmetric around \(x=0\), the following holds
    $$
        F(-x) = 1 - F(x)
    $$
    Therefore we only need to calculate \(F(x)\) for positive values of \(x\). Another result of the symmetric pdf, is that \(F(0)=0.5\) and therefore
    $$
        F(x) = 0.5 + \frac{1}{\sqrt{2\pi}} \int_{0}^x e^{-t^2/2}\,\text{dt}
    $$
    Now we need to approximate the above integral. First we can replace the exponential function with its series representation
    $$
        F(x) = 0.5 + \frac{1}{\sqrt{2\pi}} \int_{0}^x \left(\sum_{n=0}^\infty \frac{(-t^2/2)^n}{n!}\right) \,\text{dt}
    $$
    Since the series converges for all values of \(t\), we are allowed to switch the summation and the integration which gives
    \begin{align}
        F(x) &= 0.5 + \frac{1}{\sqrt{2\pi}} \sum_{n=0}^\infty\frac{(-1)^n}{2^n n!} \left(\int_{0}^x t^{2n} \,\text{dt}\right) \\
        &= 0.5 + \frac{1}{\sqrt{2\pi}} \sum_{n=0}^\infty\frac{(-1)^n}{2^n n!} \left[\frac{t^{2n+1}}{2n+1}\right]_{t=0}^x \\
        &= 0.5 + \frac{1}{\sqrt{2\pi}} \sum_{n=0}^\infty\frac{(-1)^n x^{2n+1}}{2^n n! (2n+1)} 
    \end{align}
    With this series the cdf of the standard normal distribution can be approximated by selecting \(N\) and then calculate
    $$
        F_N(x) = 0.5 + \frac{1}{\sqrt{2\pi}} \sum_{n=0}^N\frac{(-1)^n x^{2n+1}}{2^n n! (2n+1)} 
    $$
    The error that is made by only calculating the first \(N\) terms is bounded by
    $$
    |F(x) - F_N(x)| \leq \frac{x^{2N+3}}{2^{N+1} (N+1)! (2N+3)}
    $$
    By selecting \(N\) large enough we can therefore get an arbitrarily small error.
</div>
{% endblock %}

